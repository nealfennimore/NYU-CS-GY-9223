#! /usr/bin/env bash

set -Eeuo pipefail

INPUT="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"

BASE64_REGEX="^[A-Za-z0-9+/]{4}*([A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)+$"
HEX_REGEX="^[0-9a-f]+$"

clean_input() {
    sed -i input -e 's/"//g' -e "s/'//g" -e 's/\\//g'
}

echo -n "$INPUT" >input
while true; do

    FILE="$(file input)"

    if [[ $FILE =~ "ASCII" ]]; then
        clean_input
    elif [[ $FILE =~ "bzip2" ]]; then
        mv input output.bz2
        bzip2 -df output.bz2
        cp output input
        continue
    fi

    INPUT="$(cat input)"
    if [[ "$INPUT" =~ "flag{" ]]; then
        echo "$INPUT"
        rm input output
        break
    elif [[ "$INPUT" =~ $HEX_REGEX ]]; then
        echo "$INPUT" | xxd -r -p >output
    elif [[ "$INPUT" =~ $BASE64_REGEX ]]; then
        echo "$INPUT" | base64 -d >output
    fi

    cp output input
done
